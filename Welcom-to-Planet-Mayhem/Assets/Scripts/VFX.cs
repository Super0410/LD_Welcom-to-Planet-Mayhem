//=======================================================================================================================================//
// Product:    	Welcome to Planet Mayhem																								 //
// Developer : 	Pericles Barros																											 //
// Company:    	GameDevTeam																												 //
// Date: 	   	2017/04/22																						 						 //
//=======================================================================================================================================//



#region Imports

using UnityEngine;
using System.Collections;
using GameSystems.ObjectManagement;

#endregion

namespace WelcomeToPlanetMayhem
{
	public class VFX : MonoBehaviour
	{
		//===============================================================================================================================//
		//==================================================== Inspector Variables ======================================================//
		//===============================================================================================================================//

		#region Inspector Variables

		[SerializeField] float duration;

		#endregion

		//===============================================================================================================================//
		//======================================================= Private Fields ========================================================//
		//===============================================================================================================================//

		#region Private Fields

		ParticleSystem[] particles;

		#endregion

		//===============================================================================================================================//
		//==================================================== Unity Event Functions ====================================================//
		//===============================================================================================================================//

		#region Unity Event Functions

		void Start ()
		{
			particles = GetComponentsInChildren<ParticleSystem> ();
		}

		#endregion

		//===============================================================================================================================//
		//=========================================================== Public Methods ====================================================//
		//===============================================================================================================================//

		#region Public Methods

		public void Play ()
		{
			if (particles != null) {
				for (int i = 0; i < particles.Length; i++) {
					particles [i].Play ();
				}
			}

			//TODO: PlayerAudioSource2D(

			StartCoroutine (Stop ());
		}

		#endregion

		//===============================================================================================================================//
		//============================================================= Coroutines ======================================================//
		//===============================================================================================================================//

		#region Coroutines

		IEnumerator Stop ()
		{
			yield return new WaitForSeconds (duration);

			if (particles != null) {
				for (int i = 0; i < particles.Length; i++) {
					particles [i].Stop ();
				}
			}

			ObjectPooler.ReturnInstance (GetType ().Name, gameObject);			
		}

		#endregion
	}
}